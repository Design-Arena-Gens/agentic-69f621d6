"use client";

import { useEffect, useMemo, useRef, useState } from 'react';
import styles from './story.module.css';

type StoryStep = {
  id: number;
  title: string;
  text: string;
  emoji: string;
};

const steps: StoryStep[] = [
  { id: 1, title: '???', text: '???? ??? ?? ??? ???? ???? ?? ?? ????? ???? ?? ??? ?? ???? ?? ?? ???? ????', emoji: '???? ?? ??' },
  { id: 2, title: '?????', text: '???? ?? ???? ?? ??? ??? ?????? ??? ???? ???', emoji: '?????' },
  { id: 3, title: '?????', text: '?? ???? ???? ???? ?? ??? ?? ???? ??????? ???? ?? ????? ?????? ????? ?? ????? ???? ???', emoji: '????' },
  { id: 4, title: '??????', text: '????? ?????? ?? ??? ???? ???? ????', emoji: '????' },
  { id: 5, title: '???? ??????', text: '?????? ???? ?? ??? ???? ?? ???? ???? ???? ???', emoji: '????' },
  { id: 6, title: '?????', text: '?????? ?? ???? ????? ???? ??? ???? ???', emoji: '????' },
  { id: 7, title: '??????', text: '?????? ???? ?? ????? ?? ???? ???', emoji: '??????' },
  { id: 8, title: '???????', text: '????? ????? ?? ???? ?? ???? ????', emoji: '????' },
  { id: 9, title: '?????', text: '?????? ???? ?? ??? ????? ????? ???? ???', emoji: '??????????' },
  { id: 10, title: '???', text: '????? ?????? ?? ???? ??? ???? ?? ?? ?????? ???? ??? ???? ???', emoji: '????' },
  { id: 11, title: '????', text: '????? ??? ?? ???? ?? ???? ???? ??? ?? ????? ??? ??? ?????? ????', emoji: '????' },
  { id: 12, title: '????? ?? ???', text: '?????? ?? ????? ????-???? ??? ?????? ?? ??? ????? ????? ?? ???? ???? ???', emoji: '????????' },
  { id: 13, title: '??????', text: '???? ?????? ???? ?????? ???? ?? ????? ?? ???? ???', emoji: '??????' },
  { id: 14, title: '???????', text: '?????? ?? ??? ???? ????? ?? ?????? ????? ?? ???? ???', emoji: '????????' },
  { id: 15, title: '????', text: '?? ???? ??? ???? ??? ?? ???? ???? ?? ??? ???? ???', emoji: '??????' }
];

export default function Page() {
  const [index, setIndex] = useState(0);
  const [autoPlay, setAutoPlay] = useState(true);
  const intervalRef = useRef<number | null>(null);

  const progress = useMemo(() => ((index + 1) / steps.length) * 100, [index]);

  useEffect(() => {
    if (!autoPlay) return;
    if (intervalRef.current) window.clearInterval(intervalRef.current);
    intervalRef.current = window.setInterval(() => {
      setIndex((i) => (i + 1) % steps.length);
    }, 2600);
    return () => {
      if (intervalRef.current) window.clearInterval(intervalRef.current);
    };
  }, [autoPlay]);

  const step = steps[index];

  return (
    <main className={styles.main}>
      <div className={styles.container}>
        <header className={styles.header}>
          <h1>?????? ?? ????</h1>
          <p className={styles.subtitle}>?? ?????????? ????? ?????</p>
        </header>

        <div className={styles.controls}>
          <button className={styles.btn} onClick={() => setIndex((i) => (i - 1 + steps.length) % steps.length)} aria-label="Previous">? ?????</button>
          <button className={styles.btn} onClick={() => setAutoPlay((p) => !p)} aria-label="Play/Pause">{autoPlay ? '? ?????' : '?? ?????'}</button>
          <button className={styles.btn} onClick={() => setIndex((i) => (i + 1) % steps.length)} aria-label="Next">???? ?</button>
        </div>

        <div className={styles.stage}>
          <div className={styles.emoji} aria-hidden>
            {step.emoji}
          </div>
          <div className={styles.card}>
            <div className={styles.stepNum}>??? {step.id} / {steps.length}</div>
            <h2 className={styles.title}>{step.title}</h2>
            <p className={styles.text}>{step.text}</p>
          </div>
        </div>

        <div className={styles.progress}>
          <div className={styles.bar} style={{ width: `${progress}%` }} />
        </div>

        <ol className={styles.timeline}>
          {steps.map((s, i) => (
            <li key={s.id} className={`${styles.timelineItem} ${i === index ? styles.active : ''}`} onClick={() => setIndex(i)}>
              <span className={styles.dot} />
              <span className={styles.itemText}>{s.title}</span>
            </li>
          ))}
        </ol>

        <footer className={styles.footer}>
          <span>? {new Date().getFullYear()} ????? ? ????? ?? ?????? ?? ???</span>
        </footer>
      </div>
    </main>
  );
}
